---
title: 记一次项目重构
tags: 
  - 随记
  - JavaScript
  - React
  - Redux
  - redux-saga
  - create-react-app
  - react-app-rewired
---

这段时间在公司接手了一个新的项目，但是一来由于这个项目最初是另一个项目组的大佬临时加急搭起来的，二来整个文件的结构跟我习惯的不一样，写起来很别扭。再就是项目刚开始，整体代码不多，是个重构的好机会。

所以就有了这一次的重构，在此记录一下这次重构里面遇到的一些事情。

## create-react-app

比较了一下dva和create-react-app以后，还是决定用create-react-app。

主要是dva提供的redux-saga的写法跟我所期望的不大相同，所以为了更高的自由度，还是选择了create-react-app,虽然这个的自由度也不咋高。

### 安装使用

```JavaScript
yarn global add create-react-app
create-react-app app
cd app
yarn start
```

目前cli版本 1.5.2,生成的目录如下：

```
app
├── README.md
├── node_modules
├── package.json
├── .gitignore
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
└── src
    ├── App.css
    ├── App.js
    ├── App.test.js
    ├── index.css
    ├── index.js
    ├── logo.svg
    └── registerServiceWorker.js
```

然后经过一番魔改后目录变成了下面这样：

```
app
├── README.md
├── node_modules
├── .gitignore #git忽略配置文件
├── theme.js #重置antd默认样式valuables
├── package.json #依赖及配置文件
├── config-overrides.js #对create-react-app脚手架的webpack的重写覆盖
└── src
	├── images #图片文件，子结构以模块/组件划分子文件夹
	├── styles #样式文件，子结构以组件划分子文件，以路由模块划分子文件夹
	└── scripts #JS/JSX文件
		├── components #公共组件
		├── const #公共静态文件或配置文件
		├── models #redux数据
		|	├── actions #redux actions文件
		|	|	├── index.js #actions聚合文件
		|	|	└── ***.js #根据模块划分的action types 及 action creators
		|	├── reducers #redux reducer文件
		|	|	├── index.js #reducer聚合文件
		|	|	└── ***.js #根据模块划分的reducers
		|	├── sagas #redux saga文件
		|	|	├── index.js #sagas聚合文件
		|	|	└── ***.js #根据模块划分的sagas
		|	└── store
		|		├── index.js #根据dev/prod环境输出store
		|		├── dev.js #dev模式下store
		|		└── prod.js #prod模式下store
		├── pages #根据路由划分的页面模块
		|	├── PageModule #事业部模块
		|	|	├── index.js #模块Container组件，负责与redux进行store的connect，接收store中的数据，actions触发调用
		|	|	└── ***.js #模块Presentational组件，从Container接收props进行渲染，并负责维护只与自身相关的state
		|	└── ...其余类似
		├── remotes #数据相关聚合
		|	├── urls #各个页面模块请求url路径
		|	|	├── user.js #user模块url路径聚合
		|	|	└── ...其余模块与user模块类似
		|	├── index.js #请求调用函数，请求错误处理函数
		├── routes #路由聚合
		|	├── HomeRoutes.js #登录后home页面路由
		|	└── index.js #路由入口,区分登录页与home模块
		├── utils #方法函数聚合
		|	├── index.js #各种方法函数的聚合与统一导出
		|	├── type.js #变量check方法函数
		|	├── storage.js #对localStorage的操作方法，在原生localStorage方法的一些扩展
		|	├── redux.js #redux相关方法函数
		|	├── react.js #与react及reactDOM相关的方法函数
		|	└── object.js #处理类型为Object的变量的相关方法
		└── App.js #应用入口
```

主要有这么几点：

1. Redux相关的文件放在models文件夹下，并且划分成 `actions`,`sagas`,`reducers`三个小的模块，每个模块下根据页面模块不同有自己独立的代码文件。

2. 每一个页面模块下的组件分为两种

	- Container组件

	- Presentational组件

## react-app-rewired

CRA脚手架提供的webpack包括devServer配置不一定完全符合项目或者个人的需求，所以需要一定程度上对配置的重写或覆盖。

官方给了一个方法：

```
yarn run eject
```

eject方法把CRA封装的webpack配置暴露到根目录来，但是这样一来如果之后`react-scripts`升级了就无法跟随升级。另外就是还想尝试一下新东西，所以用了`react-app-rewired`来进行新的覆盖配置。

```
yarn add react-app-rewired
```

在根目录新建`config-overrides.js`文件